<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body onload="getCategories()">
    <div class="container-fluid">
        <h1 class="text-center">Supermarket</h1>
        <div class="row">
            <div class="col-md-3">
                <span class="lead text-center">Category</span>
            </div>
            <div class="col-md-9">
                <select class="form-select" onchange="getItems()" id="selectCategory">
                    <option value="0">To select</option>
                    <option value="all">All</option>

                </select>
            </div>
        </div>


        <div id="itemsList" class="row my-3 py-3">
            <p class="text-center">No items</p>
        </div>
    </div>
       <script>
        // Load categories when page loads
        function getCategories() {
            // Fetch categories from the server using Axios
            axios.get('http://localhost:3000/categories')
                .then(response => {
                    console.log('Categories received:', response.data);
                    showCategories(response.data);
                })
                .catch(error => {
                    console.error('Error fetching categories:', error);
                    // For debugging, let's add a fallback
                    console.log('Falling back to default categories');
                    showCategories(['Fruit', 'Dairy', 'Confectionary', 'Vegetable']);
                });
        }

        function showCategories(categories) {
            // Display the categories in the select element
            const selectElement = document.getElementById('selectCategory');
            
            // Clear existing options except the first two (To select, All)
            while (selectElement.children.length > 2) {
                selectElement.removeChild(selectElement.lastChild);
            }
            
            // Add category options
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                selectElement.appendChild(option);
            });
        }

        function getItems() {
            const selectedCategory = document.getElementById('selectCategory').value;
            
            // If "To select" is chosen, do nothing
            if (selectedCategory === '0') {
                const itemsList = document.getElementById('itemsList');
                // Clear existing content
                while (itemsList.firstChild) {
                    itemsList.removeChild(itemsList.firstChild);
                }
                // Add "No items" message
                const noItemsP = document.createElement('p');
                noItemsP.className = 'text-center';
                noItemsP.textContent = 'No items';
                itemsList.appendChild(noItemsP);
                return;
            }
            
            let url;
            if (selectedCategory === 'all') {
                // If "All" is chosen, fetch all items
                url = 'http://localhost:3000/items';
            } else {
                // If a specific category is chosen, fetch items for that category
                url = `http://localhost:3000/items?category=${selectedCategory}`;
            }
            
            axios.get(url)
                .then(response => {
                    showItems(response.data);
                })
                .catch(error => {
                    console.error('Error fetching items:', error);
                    const itemsList = document.getElementById('itemsList');
                    // Clear existing content
                    while (itemsList.firstChild) {
                        itemsList.removeChild(itemsList.firstChild);
                    }
                    // Add error message
                    const errorP = document.createElement('p');
                    errorP.className = 'text-center text-danger';
                    errorP.textContent = 'Error loading items';
                    itemsList.appendChild(errorP);
                });
        }

        function showItems(items) {
            // Display the items in the itemsList div
            const itemsList = document.getElementById('itemsList');
            
            // Clear existing content using DOM methods
            while (itemsList.firstChild) {
                itemsList.removeChild(itemsList.firstChild);
            }
            
            if (!items || items.length === 0) {
                const noItemsP = document.createElement('p');
                noItemsP.className = 'text-center';
                noItemsP.textContent = 'No items found';
                itemsList.appendChild(noItemsP);
                return;
            }
            
            // Create Bootstrap cards for each item
            items.forEach(item => {
                // Create column div with responsive classes
                const colDiv = document.createElement('div');
                colDiv.className = 'col-lg-4 col-md-6 col-sm-12 mb-3';
                
                // Create card
                const card = document.createElement('div');
                card.className = 'card h-100';
                
                // Create card body
                const cardBody = document.createElement('div');
                cardBody.className = 'card-body';
                
                // Create card title
                const cardTitle = document.createElement('h5');
                cardTitle.className = 'card-title';
                cardTitle.textContent = item.name;
                
                // Create card text for category
                const categoryText = document.createElement('p');
                categoryText.className = 'card-text';
                const categoryBadge = document.createElement('span');
                categoryBadge.className = 'badge bg-primary';
                categoryBadge.textContent = item.category;
                categoryText.appendChild(categoryBadge);
                
                // Create price and quantity info
                const infoText = document.createElement('p');
                infoText.className = 'card-text';
                
                const priceSpan = document.createElement('span');
                priceSpan.className = 'text-success fw-bold';
                priceSpan.textContent = `$${item.price.toFixed(2)}`;
                
                const quantitySpan = document.createElement('span');
                quantitySpan.className = 'text-muted ms-3';
                quantitySpan.textContent = `Qty: ${item.quantity}`;
                
                infoText.appendChild(priceSpan);
                infoText.appendChild(quantitySpan);
                
                // Assemble the card
                cardBody.appendChild(cardTitle);
                cardBody.appendChild(categoryText);
                cardBody.appendChild(infoText);
                card.appendChild(cardBody);
                colDiv.appendChild(card);
                
                // Add to items list
                itemsList.appendChild(colDiv);
            });
        }
    </script>

              
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
</body>

</html>